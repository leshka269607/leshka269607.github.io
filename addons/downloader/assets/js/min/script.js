$(function(){function e(e){return"number"!=typeof e?"":e>=1e9?(e/1e9).toFixed(2)+" GB":e>=1e6?(e/1e6).toFixed(2)+" MB":(e/1e3).toFixed(2)+" KB"}var n=$("#upload ul"),o=$("#drop"),a=$(".hidden-object");o[0].ondragover=function(){return o.addClass("hover"),!1},o[0].ondragleave=function(){return o.removeClass("hover"),!1},$("#drop a").click(function(){$(this).parent().find("input").click()}),$("#upload").fileupload({dropZone:$("#drop"),add:function(t,r){if("text/xml"!=r.files[0].type)return alert('Файл "'+r.files[0].name+'" неподходящего формата!'),void o.removeClass("hover");if(r.files[0].size>"1048576")return alert('Файл "'+r.files[0].name+'" слишком большой!'),void o.removeClass("hover");o.removeClass("hover"),a.removeClass("hidden-object");var i=$('<li class="working"><input type="text" value="0" data-width="48" data-height="48" data-fgColor="#0788a5" data-readOnly="1" data-bgColor="#3e4043" /><p></p><span></span></li>');i.find("p").text(r.files[0].name).append("<i>"+e(r.files[0].size)+"</i>"),r.context=i.appendTo(n),i.find("input").knob(),i.find("span").click(function(){i.hasClass("working")&&d.abort(),i.fadeOut(function(){i.remove()});var e=$("canvas");1==e.length&&a.addClass("hidden-object")});var d=r.submit()},progress:function(e,n){var o=parseInt(n.loaded/n.total*100,10);n.context.find("input").val(o).change(),100==o&&n.context.removeClass("working")},fail:function(e,n){n.context.addClass("error")}}),$(document).on("drop dragover",function(e){e.preventDefault()})});